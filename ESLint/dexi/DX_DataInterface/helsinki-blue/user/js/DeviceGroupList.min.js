var g_AllDeviceList;var g_SearchDeviceList;var g_tableIns=null;var g_isSearchMode=false;var g_AllGroupList;var cg_tree_width=253;var g_tree_config={id:"panel_id_1",ParentData:tree_parent_data,LiData:tree_parent_data,SelectionEvent:null,};var tree_parent_data=[{ParentNodeId:1,NodeName:"1",NodeText:"分组1"},];function FindDeviceGroupIndex(c,a){try{if(c==null||c.length==0||a==null){return 0}for(var d=0;d<c.length;d++){if(c[d].GROUP==a){return d+1}}}catch(b){}return 0}function conversion_data_tree_node(f,a,k){var j=[[],[]];var d;var c=0;var l;try{j[0][0]={ParentNodeId:0,NodeName:"0",NodeText:"默认分组"};if(f==null||f.length==0){c=1}else{for(var g=0;g<f.length;g++){var h=new Object;h.ParentNodeId=g+1;h.NodeName=(g+1)+"";h.NodeText=f[g].GROUP;h.expansion=true;j[0][g+1]=h}c=f.length+1}d=new Array(c);for(var g=0;g<c;g++){d[g]=0}if(a==null||a.length==0){return j}for(var g=0;g<a.length;g++){var h=new Object;l=FindDeviceGroupIndex(f,a[g].GROUP);h.ParentNodeId=l;h.NodeName=a[g].ST;h.NodeText=a[g].ST+" "+a[g].NAME;h.Select=false;j[1][g]=h;d[l]++}for(var g=0;g<j[0].length;g++){j[0][g].NodeText+="("+d[g]+")"}}catch(b){layer.alert("错误："+b.message,{icon:5,scrollbar:false})}if(k>=0&&k<j.length){j[1][k].Select=true}return j}function conversion_data_tree_node_search(a,g){var f=[[],[]];try{f[0][0]={ParentNodeId:0,NodeName:"0",NodeText:"搜索设备("+a.length+")"};if(a==null||a.length==0){return f}for(var c=0;c<a.length;c++){var d=new Object;d.ParentNodeId=0;d.NodeName=a[c].ST;d.NodeText=a[c].ST+" "+a[c].NAME;d.Select=false;f[1][c]=d}}catch(b){layer.alert("错误："+b.message,{icon:5,scrollbar:false})}if(g>=0&&g<f.length){f[1][g].Select=true}return f}function scroll_button_onclick(){try{var d=document.getElementById("div_scroll_id").getAttribute("data-user-flag");if(d==1){$("#left_panle_id").hide();var b=document.getElementById("right_panle_id");b.style.marginLeft=0+"px";var c=document.getElementById("scroll_ico_id");c.className="fa fa-chevron-right fa-2x";document.getElementById("div_scroll_id").setAttribute("data-user-flag",0)}else{$("#left_panle_id").show();document.getElementById("div_scroll_id").setAttribute("data-user-flag",1);var c=document.getElementById("scroll_ico_id");c.className="fa fa-chevron-left fa-2x";var b=document.getElementById("right_panle_id");b.style.marginLeft=cg_tree_width+"px"}}catch(a){alert("错误："+a.message)}}function search_user_list(b,f){var g=JSON.parse("[]");var a=0;if(b==null||b.length==0){layer.alert("错误：列表为空，无法搜索！",{icon:5,scrollbar:false});return g}if(f==null||f.length==0){layer.alert("错误：请输入搜索关键字！",{icon:5,scrollbar:false});return g}try{for(var d=0;d<b.length;d++){if((b[d].ST.indexOf(f)>=0)||(b[d].NAME.indexOf(f)>=0)){g[a++]=b[d];if(a>=500){layer.alert("搜索到超过500个满足条件的数据，提前结束搜索，请修改搜索条件缩小范围！",{icon:6,scrollbar:false});break}}}if(a==0){layer.alert("没有搜索到满足条件的设备数据！",{icon:5,scrollbar:false})}}catch(c){layer.alert("搜索发生了错误："+c.message,{icon:5,scrollbar:false})}return g}function search_name_onclick(){var c=document.getElementById("search_user_name_id").value;if(c==null||c.length<1){layer.msg("错误：搜索内容不能为空！",{icon:5,scrollbar:false});return}g_SearchDeviceList=search_user_list(g_AllDeviceList,c);if(g_SearchDeviceList.length==0){return}try{g_isSearchMode=true;document.getElementById("cancel_search_button_id").disabled=false;loading_message1("加载数据中...");var a=conversion_data_tree_node_search(g_SearchDeviceList,-1);g_tree_config.ParentData=a[0];g_tree_config.LiData=a[1];g_MyTree=new tree_list(g_tree_config);g_MyTree.render();layer.close(g_layer_msg_index);if(g_SearchDeviceList.length>=500){layer.msg("搜索到超过500条，只显示"+g_SearchDeviceList.length+"条记录，请缩小搜索范围！",{icon:6,scrollbar:false})}else{layer.msg("搜索到"+g_SearchDeviceList.length+"条记录！",{icon:6,scrollbar:false})}}catch(b){layer.msg("错误："+b.message,{icon:5,scrollbar:false})}}function search_cancel_onclick(){try{if(g_isSearchMode==false){return}g_isSearchMode=false;loading_message1("加载数据中...");var b=conversion_data_tree_node(g_AllGroupList,g_AllDeviceList,0);g_tree_config.ParentData=b[0];g_tree_config.LiData=b[1];g_MyTree=new tree_list(g_tree_config);g_MyTree.render();layer.close(g_layer_msg_index);document.getElementById("cancel_search_button_id").disabled="true"}catch(a){layer.alert("错误："+a.message,{icon:5,scrollbar:false})}}function ajax_sync_get_device_list(){var c=JSON.parse("[]");var b={GetFun:"GetUserDeviceList",};try{$.ajax({url:"/Home/Index",type:"POST",dataType:"json",async:false,data:b,}).done(function(d){if(d.rel==1){c=JSON.parse(d.obj);if(d.obj==null){layer.alert("没有获取到数据！",{icon:5,scrollbar:false})}else{c=JSON.parse(d.obj)}}else{if(d.rel==-1){layer.alert(d.msg,{icon:5,scrollbar:false});parent.JumpLogon()}else{layer.alert(d.msg,{icon:5,scrollbar:false})}}}).fail(function(){layer.alert("通信错误，请求数据失败！",{icon:5,scrollbar:false})})}catch(a){layer.alert("发生了错误："+a.message,{icon:5,scrollbar:false})}return c}function ajax_sync_get_pic_device_list(){var c=JSON.parse("[]");var b={GetFun:"GetUserPicDeviceList",};try{$.ajax({url:"/Home/Index",type:"POST",dataType:"json",async:false,data:b,}).done(function(d){if(d.rel==1){c=JSON.parse(d.obj);if(d.obj==null){layer.alert("没有获取到数据！",{icon:5,scrollbar:false})}else{c=JSON.parse(d.obj)}}else{if(d.rel==-1){layer.alert(d.msg,{icon:5,scrollbar:false});parent.JumpLogon()}else{layer.alert(d.msg,{icon:5,scrollbar:false})}}}).fail(function(){layer.alert("通信错误，请求数据失败！",{icon:5,scrollbar:false})})}catch(a){layer.alert("发生了错误："+a.message,{icon:5,scrollbar:false})}return c}function ajax_sync_get_all_group_list(){var c=JSON.parse("[]");var b={GetFun:"GetUserGroupList",};try{$.ajax({url:"/Home/Index",type:"POST",dataType:"json",async:false,data:b,}).done(function(d){if(d.rel==1){c=JSON.parse(d.obj);if(d.obj==null){}else{c=JSON.parse(d.obj)}}else{if(d.rel==-1){layer.alert(d.msg,{icon:5,scrollbar:false});parent.JumpLogon()}else{layer.alert(d.msg,{icon:5,scrollbar:false})}}}).fail(function(){layer.alert("通信错误，请求数据失败！",{icon:5,scrollbar:false})})}catch(a){layer.alert("发生了错误："+a.message,{icon:5,scrollbar:false})}return c}function loading_message(a){g_layer_msg_index=layer.msg("加载中",{icon:16,shade:0.5,time:60000,anim:0,scrollbar:false})}function loading_message1(a){g_layer_msg_index=layer.msg("加载中",{icon:16,shade:0,time:6000,anim:0,scrollbar:false})}function close_message(){layer.close(g_layer_msg_index)}function RefreshPage_onClick(){location.reload()};