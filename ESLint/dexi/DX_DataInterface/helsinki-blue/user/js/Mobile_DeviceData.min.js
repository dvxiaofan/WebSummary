var g_AllEssDataCache=null;var g_AllDeviceList=null;var g_AllGroupList=null;var g_RealDataObj=null;var g_ListData;var g_ThisDevice={ST:null,NAME:null,};var g_DataStartTime;var g_DataEndTime;var g_PicStartTime;var g_PicEndTime;var g_CharsList=[];var g_FieldList=[];var g_FieldNameList=[];var g_FieldUintList=[];var g_FieldDataArr=null;var g_TT=[];var g_LastSelectST=null;window.onload=function(){try{setTimeout("CacheInit()",500);var b=document.getElementById("tool_bar_id");var c=b.querySelectorAll(".tab-item");var d=Array.prototype.slice.call(c,0);d.forEach(function(e){e.onclick=function(f){var h=document.getElementById("tool_bar_id");var k=h.querySelectorAll(".tab-item");var l=document.getElementById("tab_content_id");var j=l.querySelectorAll(".tab");for(var g=0;g<k.length;g++){if(f.currentTarget.id==k[g].id){j[g].classList.add("active");k[g].classList.add("active")}else{j[g].classList.remove("active");k[g].classList.remove("active")}}}});time_init()}catch(a){layer.msg("处理数据发生了错误："+a.message,{icon:5,scrollbar:false});window.location.href="Mobile_Index"}};$(window).resize(function(){if(g_CharsList!=null&&g_CharsList.length>0){for(var a=0;a<g_CharsList.length;a++){g_CharsList[a].resize()}}});function CacheInit(){try{g_AllEssDataCache=parent.Read_AllEssDataCache();if(g_AllEssDataCache==null){g_AllEssDataCache=parent.GetAllEssData();parent.Write_AllEssDataCache(g_AllEssDataCache)}g_AllDeviceList=parent.Read_AllDeviceListCache();if(g_AllDeviceList==null){g_AllDeviceList=parent.ajax_sync_get_device_list();parent.Write_AllDeviceListCache(g_AllDeviceList)}g_AllGroupList=parent.Read_AllGroupListCache();if(g_AllGroupList==null){g_AllGroupList=parent.ajax_sync_get_all_group_list();parent.Write_AllGroupListCache(g_AllGroupList)}}catch(a){layer.msg("处理数据发生了错误："+a.message,{icon:5,scrollbar:false});window.location.href="Mobile_Index"}}function RefreshRealData(){try{g_ThisDevice=parent.Read_ThisDevice();if(g_LastSelectST!=g_ThisDevice.ST){clear_echart();clear_pic()}g_LastSelectST=g_ThisDevice.ST;SelectAndGetDeviceRealData(g_ThisDevice.ST,g_ThisDevice.NAME);layer.msg("刷新成功",{icon:6,scrollbar:false,time:500})}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function back_onclick(){try{parent.iframe_show_main_list()}catch(a){layer.msg("处理数据发生了错误："+a.message,{icon:5,scrollbar:false})}}function conversion_data_list(c){var d=JSON.parse("[]");var a=0;var l="";var b;var h=[];var j=[];var k=[];var g=[];try{if(c==null||c.length==0){var m=new Object();m.ID=(a+1)+"";m.ESS="名称";m.DATA=g_ThisDevice.NAME;d[a]=m;a++;var m=new Object();m.ID=(a+1)+"";m.ESS="编号";m.DATA=g_ThisDevice.ST;d[a]=m;a++;return d}else{var m=new Object();m.ID=(a+1)+"";m.ESS="名称";m.DATA=g_ThisDevice.NAME;d[a]=m;a++;var m=new Object();m.ID=(a+1)+"";m.ESS="编号";m.DATA=g_ThisDevice.ST;d[a]=m;a++;var m=new Object();m.ID=(a+1)+"";m.ESS="采集时间";m.DATA=c[0]["TT"];d[a]=m;a++;for(var n in c[0]){if(n!="ST"&&n!="TT"&&n!="UT"&&n!=null){h[a]=n;var m=new Object();m.ID=(a+1)+"";m.ESS=get_field_name(g_AllEssDataCache,n);m.DATA=c[0][n];m.UINT=get_field_uint(g_AllEssDataCache,n);d[a]=m;a++}}var m=new Object();m.ID=(a+1)+"";m.ESS="上传时间";m.DATA=c[0]["UT"];d[a]=m;a++}}catch(f){layer.msg("处理数据发生了错误："+f.message,{icon:5,scrollbar:false})}return d}function get_field_name(a,c){try{for(var d=0;d<a.length;d++){if(a[d].标识符ASCII码==c){return a[d].编码要素}}}catch(b){}return c}function get_field_uint(a,c){try{for(var d=0;d<a.length;d++){if(a[d].标识符ASCII码==c){return a[d].量和单位}}}catch(b){}return c}function FormatOneList(d,c){try{var b='<li class="item-content">                <div class="item-inner">                    <div class="item-title">'+d+'</div>                    <div class="item-after">'+c+"</div>                </div>                </li>";return b}catch(a){return null}}function ShowRealDataList(c,f){var b=[];try{b.push("<ul>");if(f==null||f.length==0){}else{for(i=0;i<f.length;i++){if(f[i].DATA==-9999.999){b.push(FormatOneList(f[i].ESS,"数据无效"))}else{if(f[i].DATA==null){b.push(FormatOneList(f[i].ESS,"无数据"))}else{b.push(FormatOneList(f[i].ESS,f[i].DATA+((f[i].UINT==null)?"":(" "+f[i].UINT))))}}}}b.push("</ul>");var d=document.getElementById(c);d.innerHTML=b.join("")}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function SelectAndGetDeviceRealData(c,b){try{document.getElementById("title_st_id").innerHTML=c;g_RealDataObj=ajax_sync_get_real_data(c);g_ListData=conversion_data_list(g_RealDataObj);ShowRealDataList("real_list_id",g_ListData)}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function ajax_sync_get_real_data(d){var c=JSON.parse("[]");try{var b={GetFun:"GetDeviceRealData",ST_List:d,};$.ajax({url:"/Home/Index",type:"POST",dataType:"json",async:false,data:b,}).done(function(e){if(e.rel==1){c=JSON.parse(e.obj);if(e.obj==null){layer.alert("没有获取到数据！",{icon:5,scrollbar:false})}else{c=JSON.parse(e.obj)}}else{if(e.rel==-1){layer.alert(e.msg,{icon:5,scrollbar:false});parent.JumpLogon()}else{layer.alert(e.msg,{icon:5,scrollbar:false})}}}).fail(function(){layer.alert("通信错误，请求数据失败！",{icon:5,scrollbar:false})})}catch(a){layer.alert("发生了错误："+a.message,{icon:5,scrollbar:false})}return c}function quick_search_onclick(){try{var a=[{text:"请选择查询时间段",label:true},{text:"最近1天",onClick:function(){setTimeout("quick_search(1)",300)}},{text:"最近3天",onClick:function(){setTimeout("quick_search(3)",300)}},{text:"最近5天",onClick:function(){setTimeout("quick_search(5)",300)}},{text:"最近7天",onClick:function(){setTimeout("quick_search(7)",300)}},{text:"最近15天",onClick:function(){setTimeout("quick_search(15)",300)}},{text:"最近30天",onClick:function(){setTimeout("quick_search(30)",300)}},];var b=[{text:"取消",bg:"danger"}];var d=[a,b];$.actions(d)}catch(c){$.toast("错误："+c.message)}}function quick_search(a){try{if(a==0){return}if(a<=0||a>60){return}var c=new Date();var d=new Date();d.setDate(d.getDate()-a);g_DataStartTime=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();g_DataEndTime=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();console.log("快捷搜索时间："+g_DataStartTime+" "+g_DataEndTime);$.alert();$.showPreloader();SelectAndGetDeviceHistData(g_ThisDevice.ST,g_DataStartTime,g_DataEndTime)}catch(b){$.toast("错误："+b.message)}$.hidePreloader()}function search_onclick(){try{$.alert();$.showPreloader();SelectAndGetDeviceHistData(g_ThisDevice.ST,g_DataStartTime,g_DataEndTime)}catch(a){$.toast("错误："+a.message)}$.hidePreloader()}function time_init(){try{var c=new Date();var b=new Date();b.setDate(b.getDate()-1);var f={year:b.getFullYear(),month:(b.getMonth()+1),date:b.getDate(),hours:0,minutes:0,seconds:0};var d={year:c.getFullYear(),month:(c.getMonth()+1),date:c.getDate(),hours:0,minutes:0,seconds:0};var g=[b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()];var h=[c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()];g_DataStartTime=g[0]+" 00:00:00";g_DataEndTime=h[0]+" 23:59:59";g_PicStartTime=g[0]+" 00:00:00";g_PicEndTime=h[0]+" 23:59:59";$("#start_time_id").calendar({value:g,onChange:(function(j,k,e){g_DataStartTime=e[0]+" 00:00:00"}),});$("#end_time_id").calendar({value:h,onChange:(function(j,k,e){g_DataEndTime=e[0]+" 23:59:59"}),});$("#start_time_id").val(g);$("#end_time_id").val(h);$("#pic_start_time_id").calendar({value:g,onChange:(function(j,k,e){g_PicStartTime=e[0]+" 00:00:00"}),});$("#pic_end_time_id").calendar({value:h,onChange:(function(j,k,e){g_PicEndTime=e[0]+" 23:59:59"}),});$("#pic_start_time_id").val(g);$("#pic_end_time_id").val(h)}catch(a){layer.alert("错误："+a.message,{icon:5,scrollbar:false})}}function ajax_sync_get_hist_data(h,k,b,c,j,g){var f=[];try{var d={GetFun:"GetHistData",ST:h,StartTime:k,EndTime:b,isASC:c,StartIndex:j,ReadCnt:g,};$.ajax({url:"/Home/Index",type:"POST",dataType:"json",async:false,data:d,}).done(function(e){if(e.rel==1){if(e.obj==null){}else{f=JSON.parse(e.obj)}}else{if(e.rel==-1){layer.alert(e.msg,{icon:5,scrollbar:false});parent.JumpLogon()}else{layer.msg(e.msg,{icon:5,scrollbar:false})}}}).fail(function(){layer.msg("通信错误，请求数据失败！",{icon:5,scrollbar:false})})}catch(a){layer.msg("发生了错误："+a.message,{icon:5,scrollbar:false})}return f}function clear_echart(){try{$("#smallbox").empty("");$("#echart_div_id").empty("");document.getElementById("no_data_info_id").style.display=""}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function clear_pic(){try{$("#pic_list_div_id").empty("");document.getElementById("no_pic_data_info_id").style.display=""}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function SelectAndGetDeviceHistData(d,f,b){try{g_CharsList=[];g_SelectPageIndex=0;g_HistDataObj=ajax_sync_get_hist_data(d,f,b,true,0,86400);if(g_HistDataObj!=null&&g_HistDataObj.length>0){document.getElementById("no_data_info_id").style.display="none";data_handle(g_HistDataObj);echart_div_init(g_FieldNameList.length);for(var c=0;c<g_FieldNameList.length;c++){$("#card_div_id_"+c).append(g_FieldNameList[c]+"("+g_FieldUintList[c]+")");g_CharsList[c]=ShowChars("echart_div_id_"+c,g_FieldNameList[c]+"("+g_FieldUintList[c]+")",g_TT,g_FieldDataArr[c])}}else{clear_echart();setTimeout('delay_toast("错误：没有数据！")',500)}}catch(a){layer.msg("错误："+a.message,{icon:5,scrollbar:false})}}function delay_toast(a){$.toast(a)}function Format_Card_Echart(c){try{var b='<div class="card">                <div class="card-header"   id="card_div_id_'+c+'"></div>                <div class="card-content">                    <div class="card-content-inner"  id="echart_div_id_'+c+'" style="width:100%;height:320px;margin-top:-40px;"></div>                </div>                </div>';return b}catch(a){}return null}function echart_div_init(a){try{$("#echart_div_id").empty("");if(a==0){return}for(var c=0;c<a;c++){$("#echart_div_id").append(Format_Card_Echart(c))}}catch(b){layer.msg("错误："+b.message,{icon:5,scrollbar:false})}}function data_handle(a){var b;try{b=0;g_FieldList=[];g_FieldNameList=[];g_FieldUintList=[];g_FieldDataArr=null;g_TT=[];if(a==null||a.length==0){return}for(var k in a[0]){if(k!="ST"&&k!="TT"&&k!="UT"&&k!=null){g_FieldList[b]=k;g_FieldNameList[b]=get_field_name(g_AllEssDataCache,k);g_FieldUintList[b]=get_field_uint(g_AllEssDataCache,k);b++}}var h=[];for(var f=0;f<g_FieldList.length;f++){var g=[];h[f]=g}for(var d=0;d<a.length;d++){g_TT[d]=a[d].TT;for(var f=0;f<g_FieldList.length;f++){h[f][d]=a[d][g_FieldList[f]]}}g_FieldDataArr=h}catch(c){layer.msg("错误："+c.message,{icon:5,scrollbar:false})}}function get_field_name(a,c){try{for(var d=0;d<a.length;d++){if(a[d].标识符ASCII码==c){return a[d].编码要素}}}catch(b){}return c}function get_field_uint(a,c){try{for(var d=0;d<a.length;d++){if(a[d].标识符ASCII码==c){return a[d].量和单位}}}catch(b){}return c}function ShowChars(a,d,e,f){if(f==undefined){return}if(f.length<0){return}var c=Number(f[0]);var b=f[0];for(var g=0;g<f.length;g++){if(Number(c)>Number(f[g])){c=Number(f[g])}if(Number(b)<Number(f[g])){b=Number(f[g])}}c=c.toFixed(3);if(Number(c)==Number(b)){b=Number(b)+1;c=Number(c)-1;if(c<0){c=-0.1}}else{b=Number(b)+1;c=Number(c)-1;if(c<0){c=0}}b=b.toFixed(3);var h=null;if(h==null){h=echarts.init(document.getElementById(a))}option={grid:{bottom:80,left:"15%",right:"5%",},tooltip:{trigger:"axis",axisPointer:{animation:false}},dataZoom:[{show:true,realtime:true,start:40,end:60},{type:"inside",realtime:true,start:0,end:100}],xAxis:[{type:"category",boundaryGap:false,axisLine:{onZero:false},data:e.map(function(j){return j.replace(" ","\n")})}],yAxis:[{type:"value",max:b,min:c}],series:[{name:d,type:"line",animation:false,areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgb(63, 167, 220)"},{offset:1,color:"rgb(39, 126, 171)"}])}},lineStyle:{normal:{width:0.1}},data:f}]};h.clear();h.setOption(option);return h};